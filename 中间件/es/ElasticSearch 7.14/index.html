<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>ElasticSearch 7.14-分布式搜索引擎 - koala</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">koala</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Java <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Java/Java%E6%B5%81/" class="dropdown-item">Java流</a>
</li>
                                    
<li>
    <a href="../../../Java/Java%E7%BC%96%E7%A0%81/" class="dropdown-item">Java编码</a>
</li>
                                    
<li>
    <a href="../../../Java/LocalDateTime%E5%A4%84%E7%90%86/" class="dropdown-item">LocalDateTime处理</a>
</li>
                                    
<li>
    <a href="../../../Java/%E5%8F%8D%E5%B0%84/" class="dropdown-item">反射</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">加密算法</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../Java/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/%E5%85%A5%E9%97%A8/" class="dropdown-item">入门</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">多线程</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/ThreadLoacl/" class="dropdown-item">ThreadLoacl</a>
</li>
            
<li>
    <a href="../../../Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/volatile/" class="dropdown-item">Volatile</a>
</li>
            
<li>
    <a href="../../../Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-notion/" class="dropdown-item">并发编程 notion</a>
</li>
            
<li>
    <a href="../../../Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="dropdown-item">并发编程</a>
</li>
            
<li>
    <a href="../../../Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/%E8%8D%89%E7%A8%BF/" class="dropdown-item">草稿</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">PC端 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../PC%E7%AB%AF/electron/" class="dropdown-item">Electron</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Liunx <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../liunx/git%20%E5%91%BD%E4%BB%A4/" class="dropdown-item">Git 命令</a>
</li>
                                    
<li>
    <a href="../../../liunx/jenkins/" class="dropdown-item">Jenkins</a>
</li>
                                    
<li>
    <a href="../../../liunx/yum%20%E5%91%BD%E4%BB%A4/" class="dropdown-item">Yum 命令</a>
</li>
                                    
<li>
    <a href="../../../liunx/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="dropdown-item">常用命令</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Python <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../python/QT5/" class="dropdown-item">QT5</a>
</li>
                                    
<li>
    <a href="../../../python/numpy/" class="dropdown-item">Numpy</a>
</li>
                                    
<li>
    <a href="../../../python/turtle/" class="dropdown-item">Turtle</a>
</li>
                                    
<li>
    <a href="../../../python/%E6%95%A3%E4%B9%B1%E7%9F%A5%E8%AF%86/" class="dropdown-item">散乱知识</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Socket <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../socket/socket%20%E8%8D%89%E7%A8%BF/" class="dropdown-item">Socket 草稿</a>
</li>
                                    
<li>
    <a href="../../../socket/socket%20%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5%E6%91%98%E8%A6%81/" class="dropdown-item">Socket 重要概念摘要</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Srping 系列 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Security</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/security/Oauth2%20%E5%9B%9B%E7%A7%8D%E6%8E%88%E6%9D%83%E6%A8%A1%E5%BC%8F/" class="dropdown-item">Oauth2 四种授权模式</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/security/Q%26A/" class="dropdown-item">Q&A</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/security/demo%20%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA%E5%AD%A6%E4%B9%A0/" class="dropdown-item">Demo 项目搭建学习</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/security/token%20%E7%B3%BB%E5%88%97%E7%9F%A5%E8%AF%86/" class="dropdown-item">Token 系列知识</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/security/%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3/" class="dropdown-item">参考文档</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/security/%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="dropdown-item">授权服务器配置</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">详解</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/security/%E8%AF%A6%E8%A7%A3/TokenStore/" class="dropdown-item">TokenStore</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">开发问题详解</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/mybatis-plus/" class="dropdown-item">Mybatis plus</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/sql%E8%AF%AD%E5%8F%A5/" class="dropdown-item">Sql语句</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/%E4%BC%A0%E5%8F%82%E6%95%B0/" class="dropdown-item">传参数</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B/" class="dropdown-item">切面编程</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/%E5%8F%82%E6%95%B0%E6%95%88%E9%AA%8C/" class="dropdown-item">参数效验</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/%E5%BC%80%E5%8F%91%E6%A6%82%E5%8F%99/" class="dropdown-item">开发概叙</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/%E5%BC%80%E5%8F%91%E6%B3%A8%E6%84%8F/" class="dropdown-item">开发注意</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/%E6%95%88%E9%AA%8C/" class="dropdown-item">效验</a>
</li>
            
<li>
    <a href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/%E8%A7%84%E8%8C%83%E9%97%AE%E9%A2%98/" class="dropdown-item">规范问题</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">中间件 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Es</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">ElasticSearch 7.14-分布式搜索引擎</a>
</li>
            
<li>
    <a href="../es/" class="dropdown-item">Es</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Nacos</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../nacos/KubeSphere%20%E9%83%A8%E7%BD%B2%20nacos/" class="dropdown-item">KubeSphere 部署 nacos</a>
</li>
            
<li>
    <a href="../../nacos/nacos%E5%91%BD%E4%BB%A4/" class="dropdown-item">Nacos命令</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">消息队列</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ%E5%85%A8%E6%99%AF%E5%9B%BE/" class="dropdown-item">RocketMQ全景图</a>
</li>
            
<li>
    <a href="../../%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/rocketMQ%20%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" class="dropdown-item">rocketMQ 官方文档阅读笔记</a>
</li>
            
<li>
    <a href="../../%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/rocketmq%20%E5%9F%BA%E6%9C%AC%E6%A0%B7%E4%BE%8B/" class="dropdown-item">Rocketmq 基本样例</a>
</li>
            
<li>
    <a href="../../%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/rocketmq%20%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%BD%BF%E7%94%A8/" class="dropdown-item">Rocketmq 控制台使用</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">云原生 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../%E4%BA%91%E5%8E%9F%E7%94%9F/kubemetes%E5%91%BD%E4%BB%A4/" class="dropdown-item">Kubemetes命令</a>
</li>
                                    
<li>
    <a href="../../../%E4%BA%91%E5%8E%9F%E7%94%9F/kubesphere/" class="dropdown-item">Kubesphere</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">DevOps</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E4%BA%91%E5%8E%9F%E7%94%9F/DevOps/DevOps/" class="dropdown-item">DevOps</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Docker</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%20%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" class="dropdown-item">Docker 命令大全</a>
</li>
            
<li>
    <a href="../../../%E4%BA%91%E5%8E%9F%E7%94%9F/docker/docker%20%E6%A1%88%E4%BE%8B/" class="dropdown-item">Docker 案例</a>
</li>
            
<li>
    <a href="../../../%E4%BA%91%E5%8E%9F%E7%94%9F/docker/k8s%E5%91%BD%E4%BB%A4/" class="dropdown-item">K8s命令</a>
</li>
            
<li>
    <a href="../../../%E4%BA%91%E5%8E%9F%E7%94%9F/docker/%E9%97%AE%E9%A2%98/" class="dropdown-item">问题</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">开发常见问题 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/mybatis%20%E7%BC%96%E5%86%99/" class="dropdown-item">Mybatis 编写</a>
</li>
                                    
<li>
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/%E5%AE%9E%E4%BD%93%E7%B1%BB/" class="dropdown-item">实体类</a>
</li>
                                    
<li>
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9A%E4%B9%89/" class="dropdown-item">数据库定义</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">解决方案</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/%E9%99%90%E5%88%B6%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%A7%E5%B0%8F/" class="dropdown-item">限制文件上传大小</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">开源项目 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/%E5%8F%82%E4%B8%8E%E5%BC%80%E6%BA%90/" class="dropdown-item">参与开源</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">微服务 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1/K8S%20%E5%85%A5%E9%97%A8/" class="dropdown-item">K8S 入门</a>
</li>
                                    
<li>
    <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1/NACOS%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="dropdown-item">NACOS 基础知识</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Spring cloud</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1/spring-cloud/spring-cloud%20%E5%AD%A6%E4%B9%A0/" class="dropdown-item">Spring cloud 学习</a>
</li>
            
<li>
    <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1/spring-cloud/%E7%BD%91%E5%85%B3/" class="dropdown-item">网关</a>
</li>
            
<li>
    <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1/spring-cloud/%E7%BD%91%E5%85%B3%E9%9B%86%E6%88%90Oauth2%E8%AF%A6%E8%A7%A3/" class="dropdown-item">网关集成Oauth2详解</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">数据库 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Mybatis</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mybatis/mybatis%20%E5%85%A8%E8%A7%A3/" class="dropdown-item">使用案例</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Mybatis plus</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mybatis-plus/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E8%AF%A6%E8%A7%A3/" class="dropdown-item">官方文档详解</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Mysql</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="dropdown-item">Mysql 常用命令</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%20%E7%B4%A2%E5%BC%95%E7%AF%87/" class="dropdown-item">Mysql 索引篇</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%B2%97%E8%AF%BB/" class="dropdown-item">Mysql官方文档粗读</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E7%BC%96%E7%A8%8B/" class="dropdown-item">Mysql编程</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E8%AF%A6%E8%A7%A3/" class="dropdown-item">Mysql详解</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E9%97%AE%E9%A2%98%E5%A4%A7%E5%85%A8/" class="dropdown-item">Mysql问题大全</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/readme/" class="dropdown-item">Readme</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Mysql45讲</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql45%E8%AE%B2/Info/" class="dropdown-item">Info</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql45%E8%AE%B2/%E6%97%A5%E5%BF%97/" class="dropdown-item">日志</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Redis</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis%20%E5%9F%BA%E7%A1%80%E6%96%87%E6%A1%A3/" class="dropdown-item">Redis 基础文档</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis%20%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%AC%94%E8%AE%B0/" class="dropdown-item">Redis 官方文档笔记</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%8E%9F%E7%94%9F%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/" class="dropdown-item">原生分布式锁实现方式</a>
</li>
            
<li>
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="dropdown-item">常见问题</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">社招面试 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../%E7%A4%BE%E6%8B%9B%E9%9D%A2%E8%AF%95/%E5%8F%82%E8%80%83/" class="dropdown-item">参考</a>
</li>
                                    
<li>
    <a href="../../../%E7%A4%BE%E6%8B%9B%E9%9D%A2%E8%AF%95/%E6%9D%82%E9%A1%B9/" class="dropdown-item">杂项</a>
</li>
                                    
<li>
    <a href="../../../%E7%A4%BE%E6%8B%9B%E9%9D%A2%E8%AF%95/%E9%A9%AC%E5%A3%AB%E5%85%B5%E9%9D%A2%E8%AF%95%E8%A7%86%E9%A2%912023/" class="dropdown-item">马士兵面试视频2023</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">设计模式 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F/" class="dropdown-item">模板模式</a>
</li>
                                    
<li>
    <a href="../../../%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" class="dropdown-item">观察者模式</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../../srping%20%E7%B3%BB%E5%88%97/%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/%E8%A7%84%E8%8C%83%E9%97%AE%E9%A2%98/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../es/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#elasticsearch-714-" class="nav-link">ElasticSearch 7.14-分布式搜索引擎</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#_1" class="nav-link">全文检索</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">简介</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_3" class="nav-link">安装</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#kibana" class="nav-link">Kibana</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_9" class="nav-link">核心概念</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_13" class="nav-link">基本操作</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_27" class="nav-link">高级查询</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_31" class="nav-link">索引原理</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_34" class="nav-link">分词器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_40" class="nav-link">过滤查询</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_44" class="nav-link">整合应用</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_61" class="nav-link">聚合查询</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cluster" class="nav-link">集群 Cluster</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="elasticsearch-714-">ElasticSearch 7.14-分布式搜索引擎</h1>
<p><code>编程不良人</code></p>
<ol>
<li>全文检索</li>
<li>简介</li>
<li>安装</li>
<li>kibana</li>
<li>核心概念 索引 映射 文档</li>
<li>高级查询 Query DSL</li>
<li>索引原理</li>
<li>分词器</li>
<li>过滤查询</li>
<li>聚合查询</li>
<li>整合应用</li>
<li>集群</li>
</ol>
<h2 id="_1">全文检索</h2>
<p><code>全文检索</code>是计算机程序通过扫描文章中的<code>每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置</code>。当用户<code>查询时根据建立的索引查找</code>，类似于通过字典的检索字表查字的过程。</p>
<p>索: 建立索引 文本----&gt;切分 ---&gt; 词 文章出现过  出现多少次 </p>
<p>检索: 查询  关键词---&gt; 索引中--&gt; 符合条件文章  相关度排序</p>
<p>全文检索(Full-Text Retrieval)以文本作为检索对象，找出含有指定词汇的文本。<strong>全面、准确和快速是衡量全文检索系统的关键指标。</strong></p>
<ul>
<li><code>只处理文本、不处理语义</code>  </li>
<li><code>搜索时英文不区分大小写</code> </li>
<li><code>结果列表有相关度排序</code></li>
</ul>
<h2 id="_2">简介</h2>
<h4 id="elasticsearch">什么是ElasticSearch</h4>
<p>​   <code>ElasticSearch</code> 简称 <code>ES</code> ，是基于<code>Apache Lucene</code>构建的<code>开源搜索引擎</code>，是当前最流行的<code>企业级搜索引擎</code>。<code>Lucene本身就可以被认为迄今为止性能最好的一款开源搜索引擎工具包</code>，但是lucene的API相对复杂，需要深厚的搜索理论。很难集成到实际的应用中去。<code>ES是采用java语言编写，提供了简单易用的RestFul API，开发者可以使用其简单的RestFul API，开发相关的搜索功能，从而避免lucene的复杂性</code>。</p>
<h4 id="elasticsearch_1">ElasticSearch诞生</h4>
<p>​   多年前，一个叫做<code>Shay Banon</code>的刚结婚不久的失业开发者，由于妻子要去伦敦学习厨师，他便跟着也去了。在他找工作的过程中，为了给妻子构建一个食谱的搜索引擎，他开始构建一个早期版本的<code>Lucene</code>。</p>
<p>直接基于Lucene工作会比较困难，所以<code>Shay</code>开始抽象<code>Lucene</code>代码以便Java程序员可以在应用中添加搜索功能。他发布了他的第一个开源项目，叫做“<code>Compass</code>”。</p>
<p>后来<code>Shay</code>找到一份工作，这份工作处在<code>高性能和内存数据网格的分布式环境中</code>，因此<code>高性能的、实时的、分布式的搜索引擎</code>也是理所当然需要的。然后他决定重写<code>Compass</code>库使其成为一个独立的服务叫做<code>Elasticsearch</code>。</p>
<p>第一个公开版本出现在<code>2010年2月</code>，在那之后Elasticsearch已经成为Github上<code>最受欢迎的项目之一，</code>代码贡献者超过<code>300</code>人。一家主营<code>Elasticsearch的公司</code>就此成立，他们一边提供商业支持一边开发新功能，不过<code>Elasticsearch将永远开源</code>且对所有人可用。</p>
<p>Shay的妻子依旧等待着她的<code>食谱搜索……</code></p>
<p>目前国内大厂几乎无一不用Elasticsearch，阿里，腾讯，京东，美团 等等 .....</p>
<h2 id="_3">安装</h2>
<ul>
<li>传统方式安装  下载安装包---&gt; 平台 window macos  linux(ubuntu)</li>
<li>Docker 方式安装  推荐</li>
</ul>
<h3 id="_4">传统方式安装</h3>
<pre><code class="language-markdown"># 0.环境准备
- centos7.x+、ubuntu、windows、macos
- 安装jdk11.0+ 并配置环境变量 jdk8 

# 1.下载ES
- https://www.elastic.co/cn/start
</code></pre>
<p><img alt="image-20210816103401531" src="../ElasticSearch%207.14.assets/image-20210816103401531.png" /></p>
<pre><code class="language-markdown"># 2.安装ES不用使用root用户,创建普通用户
</code></pre>
<pre><code class="language-shell"># 添加用户名
$ useradd chenyn
# 修改密码
$ passwd chenyn
# 普通用户登录
</code></pre>
<pre><code class="language-markdown"># 3.解压缩ES安装包
</code></pre>
<pre><code class="language-shell">$ tar -zxvf elasticsearch-7.14.0-linux-x86_64.tar.gz 
$ ll
总用量 650168
drwxr-xr-x. 10 chenyn chenyn       167 8月  16 11:07 elasticsearch-7.14.0
</code></pre>
<pre><code class="language-markdown"># 4.查看ES解压包中目录结构
</code></pre>
<pre><code class="language-shell">[chenyn@localhost elasticsearch-7.14.0]$ ll
- bin       启动ES服务脚本目录
- config  ES配置文件的目录
- data    ES的数据存放目录
- jdk     ES提供需要指定的jdk目录
- lib     ES依赖第三方库的目录
- logs    ES的日志目录
- modules 模块的目录
- plugins 插件目录
</code></pre>
<p><img alt="image-20210816131801300" src="../ElasticSearch%207.14.assets/image-20210816131801300.png" /></p>
<pre><code class="language-markdown"># 5.启动ES服务
</code></pre>
<pre><code class="language-shell">[chenyn@localhost ~]$ ./elasticsearch-7.14.0/bin/elasticsearch
</code></pre>
<p><img alt="image-20210816132834613" src="../ElasticSearch%207.14.assets/image-20210816132834613.png" /></p>
<pre><code class="language-markdown">- 这个错误时系统jdk版本与es要求jdk版本不一致,es默认需要jdk11以上版本,当前系统使用的jdk8,需要从新安装jdk11才行!
- 解决方案:
    1.安装jdk11+ 配置环境变量、
    2.ES包中jdk目录就是es需要jdk,只需要将这个目录配置到ES_JAVA_HOME环境变即可、
</code></pre>
<pre><code class="language-markdown"># 6.配置环境变量
</code></pre>
<pre><code class="language-shell">$ vim /etc/profile
- export ES_JAVA_HOME=指定为ES安装目录中jdk目录
- source /etc/profile
</code></pre>
<p><img alt="image-20210816135925943" src="../ElasticSearch%207.14.assets/image-20210816135925943.png" /></p>
<pre><code class="language-markdown"># 7.从新启动ES服务
</code></pre>
<p><img alt="image-20210816140453458" src="../ElasticSearch%207.14.assets/image-20210816140453458.png" /></p>
<pre><code class="language-markdown"># 8.ES启动默认监听9200端口,访问9200
</code></pre>
<pre><code class="language-shell">$ curl http://localhost:9200
</code></pre>
<p><img alt="image-20210816143542689" src="../ElasticSearch%207.14.assets/image-20210816143542689.png" /></p>
<h5 id="_5">开启远程访问</h5>
<pre><code class="language-markdown"># 1.默认ES无法使用主机ip进行远程连接,需要开启远程连接权限
- 修改ES安装包中config/elasticsearch.yml配置文件
</code></pre>
<pre><code class="language-shell">$ vim elasticsearch.yml
</code></pre>
<p><img alt="image-20210816145724047" src="../ElasticSearch%207.14.assets/image-20210816145724047.png" /></p>
<pre><code class="language-markdown"># 2.重新启动ES服务
- ./elasticsearch
- 启动出现如下错误:
    `bootstrap check failure [1] of [4]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]
    `bootstrap check failure [2] of [4]: max number of threads [3802] for user [chenyn] is too low, increase to at least [4096]
    `bootstrap check failure [3] of [4]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]
    `bootstrap check failure [4] of [4]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers
</code></pre>
<p><img alt="image-20210816150025038" src="../ElasticSearch%207.14.assets/image-20210816150025038.png" /></p>
<pre><code class="language-markdown"># 3.解决错误-1
</code></pre>
<pre><code class="language-shell">$ vim /etc/security/limits.conf
</code></pre>
<pre><code class="language-markdown"># 在最后面追加下面内容
*               soft    nofile          65536
*               hard    nofile          65536
*               soft    nproc           4096
*               hard    nproc           4096
# 退出重新登录检测配置是否生效:
ulimit -Hn
ulimit -Sn
ulimit -Hu
ulimit -Su
</code></pre>
<pre><code class="language-markdown"># 3.解决错误-2
</code></pre>
<pre><code class="language-shell">#进入limits.d目录下修改配置文件。
$ vim /etc/security/limits.d/20-nproc.conf
# 修改为 
启动ES用户名 soft nproc 4096
</code></pre>
<pre><code class="language-markdown"># 3.解决错误-3
</code></pre>
<pre><code class="language-shell"># 编辑sysctl.conf文件
$ vim /etc/sysctl.conf
vm.max_map_count=655360 #centos7 系统
vm.max_map_count=262144 #ubuntu 系统
# 执行以下命令生效：
$ sysctl -p
</code></pre>
<pre><code class="language-markdown"># 3.解决错误-4
</code></pre>
<pre><code class="language-shell"># 编辑elasticsearch.yml配置文件
$ vim conf/elasticsearch.yml
cluster.initial_master_nodes: [&quot;node-1&quot;]
</code></pre>
<pre><code class="language-markdown"># 4.重启启动ES服务,并通过浏览器访问
</code></pre>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;localhost.localdomain&quot;,
  &quot;cluster_name&quot;: &quot;elasticsearch&quot;,
  &quot;cluster_uuid&quot;: &quot;OWh3xLYwR-6lZ_fQNhVY3A&quot;,
  &quot;version&quot;: {
    &quot;number&quot;: &quot;7.14.0&quot;,
    &quot;build_flavor&quot;: &quot;default&quot;,
    &quot;build_type&quot;: &quot;tar&quot;,
    &quot;build_hash&quot;: &quot;dd5a0a2acaa2045ff9624f3729fc8a6f40835aa1&quot;,
    &quot;build_date&quot;: &quot;2021-07-29T20:49:32.864135063Z&quot;,
    &quot;build_snapshot&quot;: false,
    &quot;lucene_version&quot;: &quot;8.9.0&quot;,
    &quot;minimum_wire_compatibility_version&quot;: &quot;6.8.0&quot;,
    &quot;minimum_index_compatibility_version&quot;: &quot;6.0.0-beta1&quot;
  },
  &quot;tagline&quot;: &quot;You Know, for Search&quot;
}
</code></pre>
<h3 id="docker">Docker方式安装</h3>
<pre><code class="language-markdown"># 1.获取镜像
- docker pull elasticsearch:7.14.0

# 2.运行es
- docker run -d -p 9200:9200 -p 9300:9300  -e &quot;discovery.type=single-node&quot;  elasticsearch:7.14.0

# 3.访问ES
- http://10.15.0.5:9200/
</code></pre>
<hr />
<h2 id="kibana">Kibana</h2>
<h3 id="_6">简介</h3>
<p><code>Kibana Navicat</code>是一个针对<code>Elasticsearch mysql</code>的<code>开源分析及可视化平台</code>，使用Kibana可以<code>查询、查看并与存储在ES索引的数据进行交互操作</code>，使用Kibana能执行高级的<code>数据分析，并能以图表、表格和地图的形式查看数据。</code></p>
<h3 id="_7">安装</h3>
<h4 id="_8">传统方式安装</h4>
<pre><code class="language-markdown">
# 1. 下载Kibana
- https://www.elastic.co/downloads/kibana

# 2. 安装下载的kibana
- $ tar -zxvf kibana-7.14.0-linux-x86_64.tar.gz 

# 3. 编辑kibana配置文件
- $ vim /Kibana 安装目录中 config 目录/kibana/kibana.yml

# 4. 修改如下配置
- server.host: &quot;0.0.0.0&quot;                        # 开启kibana远程访问
- elasticsearch.hosts: [&quot;http://localhost:9200&quot;]   #ES服务器地址

# 5. 启动kibana
- ./bin/kibana

# 6. 访问kibana的web界面  
- http://10.15.0.5:5601/   #kibana默认端口为5601    
</code></pre>
<h4 id="docker_1">Docker方式安装</h4>
<pre><code class="language-markdown"># 1.获取镜像
- docker pull kibana:7.14.0

# 2.运行kibana
- docker run -d  --name kibana -p 5601:5601 kibana:7.14.0

# 3.进入容器连接到ES,重启kibana容器,访问
- http://10.15.0.3:5601

# 4.基于数据卷加载配置文件方式运行
- a.从容器复制kibana配置文件出来
- b.修改配置文件为对应ES服务器地址
- c.通过数据卷加载配置文件方式启动
  `docker run -d -v /root/kibana.yml:/usr/share/kibana/config/kibana.yml  --name kibana -p 5601:5601 kibana:7.14.0
</code></pre>
<h4 id="compose">compose方式安装</h4>
<pre><code class="language-yml">version: &quot;3.8&quot;
volumes:
  data:
  config:
  plugin:
networks:
  es:
services:
  elasticsearch:
    image: elasticsearch:7.14.0
    ports:
      - &quot;9200:9200&quot;
      - &quot;9300:9300&quot;
    networks:
      - &quot;es&quot;
    environment:
      - &quot;discovery.type=single-node&quot;
      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;
    volumes:
      - data:/usr/share/elasticsearch/data
      - config:/usr/share/elasticsearch/config
      - plugin:/usr/share/elasticsearch/plugins

  kibana:
    image: kibana:7.14.0
    ports:
      - &quot;5601:5601&quot;
    networks:
      - &quot;es&quot;
    volumes:
      - ./kibana.yml:/usr/share/kibana/config/kibana.yml
</code></pre>
<pre><code class="language-yml"># kibana配置文件 连接到ES
server.host: &quot;0&quot;
server.shutdownTimeout: &quot;5s&quot;
elasticsearch.hosts: [ &quot;http://elasticsearch:9200&quot; ]
monitoring.ui.container.elasticsearch.enabled: true
</code></pre>
<h2 id="_9">核心概念</h2>
<h3 id="_10">索引<Index></h3>
<p><strong><code>一个索引就是一个拥有几分相似特征的文档的集合</code></strong>。比如说，你可以有一个商品数据的索引，一个订单数据的索引，还有一个用户数据的索引。<strong><code>一个索引由一个名字来标识</code></strong><code>(必须全部是小写字母的)</code><strong>，</strong>并且当我们要对这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。</p>
<h3 id="_11">映射<Mapping></h3>
<p><strong><code>映射是定义一个文档和它所包含的字段如何被存储和索引的过程</code></strong>。在默认配置下，ES可以根据插入的数据<code>自动地创建mapping，也可以手动创建mapping</code>。 mapping中主要包括字段名、字段类型等 </p>
<h3 id="_12">文档<Document></h3>
<p><strong><code>文档是索引中存储的一条条数据。一条文档是一个可被索引的最小单元</code></strong>。ES中的文档采用了轻量级的JSON格式数据来表示。 </p>
<hr />
<h2 id="_13">基本操作</h2>
<h3 id="_14">索引<index></h3>
<h4 id="_15">创建</h4>
<pre><code class="language-markdown"># 1.创建索引
- PUT /索引名 ====&gt; PUT /products
- 注意: 
        1.ES中索引健康转态  red(索引不可用) 、yellwo(索引可用,存在风险)、green(健康)
        2.默认ES在创建索引时回为索引创建1个备份索引和一个primary索引

# 2.创建索引 进行索引分片配置
- PUT /products
{
  &quot;settings&quot;: {
    &quot;number_of_shards&quot;: 1, #指定主分片的数量
    &quot;number_of_replicas&quot;: 0 #指定副本分片的数量
  }
}
</code></pre>
<p><img alt="image-20211020205824120" src="../ElasticSearch%207.14.assets/image-20211020205824120.png" /></p>
<h4 id="_16">查询</h4>
<pre><code class="language-markdown"># 查询索引
- GET /_cat/indices?v
</code></pre>
<p><img alt="image-20211020210043010" src="../ElasticSearch%207.14.assets/image-20211020210043010.png" /></p>
<h4 id="_17">删除</h4>
<pre><code class="language-markdown"># 3.删除索引
- DELETE /索引名 =====&gt; DELETE /products
- DELETE /*     `*代表通配符,代表所有索引`
</code></pre>
<p><img alt="image-20211020205934645" src="../ElasticSearch%207.14.assets/image-20211020205934645.png" /></p>
<h3 id="_18">映射<mapping></h3>
<h4 id="_19">创建</h4>
<p>字符串类型: keyword 关键字 关键词 、text 一段文本</p>
<p>数字类型：integer long  </p>
<p>小数类型：float double</p>
<p>布尔类型：boolean </p>
<p>日期类型：date</p>
<pre><code class="language-markdown"># 1.创建索引&amp;映射
</code></pre>
<pre><code class="language-json">PUT /products
{ 
  &quot;settings&quot;: {
    &quot;number_of_shards&quot;: 1,
    &quot;number_of_replicas&quot;: 0
  }, 
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;title&quot;:{
        &quot;type&quot;: &quot;keyword&quot;
      },
      &quot;price&quot;:{
        &quot;type&quot;: &quot;double&quot;
      },
      &quot;created_at&quot;:{
        &quot;type&quot;: &quot;date&quot;
      },
      &quot;description&quot;:{
        &quot;type&quot;: &quot;text&quot;
      }
    }
  }
}
</code></pre>
<p><img alt="image-20211020211425811" src="../ElasticSearch%207.14.assets/image-20211020211425811.png" /></p>
<blockquote>
<p>说明: ES中支持字段类型非常丰富，如：text、keyword、integer、long、ip 等。更多参见https://www.elastic.co/guide/en/elasticsearch/reference/7.15/mapping-types.html</p>
</blockquote>
<h4 id="_20">查询</h4>
<pre><code class="language-markdown"># 1.查看某个索引的映射
- GET /索引名/_mapping =====&gt; GET /products/_mapping
</code></pre>
<p><img alt="image-20211020211531271" src="../ElasticSearch%207.14.assets/image-20211020211531271.png" /></p>
<h3 id="_21">文档<document></h3>
<h4 id="_22">添加文档</h4>
<pre><code class="language-http">POST /products/_doc/1 #指定文档id 
{
  &quot;title&quot;:&quot;iphone13&quot;,
  &quot;price&quot;:8999.99,
  &quot;created_at&quot;:&quot;2021-09-15&quot;,
  &quot;description&quot;:&quot;iPhone 13屏幕采用6.1英寸OLED屏幕。&quot;
}
</code></pre>
<pre><code class="language-http">POST /products/_doc/ #自动生成文档id
{
  &quot;title&quot;:&quot;iphone14&quot;,
  &quot;price&quot;:8999.99,
  &quot;created_at&quot;:&quot;2021-09-15&quot;,
  &quot;description&quot;:&quot;iPhone 13屏幕采用6.8英寸OLED屏幕&quot;
}
</code></pre>
<pre><code class="language-json">{
  &quot;_index&quot; : &quot;products&quot;,
  &quot;_type&quot; : &quot;_doc&quot;,
  &quot;_id&quot; : &quot;sjfYnXwBVVbJgt24PlVU&quot;,
  &quot;_version&quot; : 1,
  &quot;result&quot; : &quot;created&quot;,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;failed&quot; : 0
  },
  &quot;_seq_no&quot; : 3,
  &quot;_primary_term&quot; : 1
}
</code></pre>
<h4 id="_23">查询文档</h4>
<pre><code class="language-json">GET /products/_doc/1
</code></pre>
<pre><code class="language-json">{
  &quot;_index&quot; : &quot;products&quot;,
  &quot;_type&quot; : &quot;_doc&quot;,
  &quot;_id&quot; : &quot;1&quot;,
  &quot;_version&quot; : 1,
  &quot;_seq_no&quot; : 0,
  &quot;_primary_term&quot; : 1,
  &quot;found&quot; : true,
  &quot;_source&quot; : {
    &quot;title&quot; : &quot;iphone13&quot;,
    &quot;price&quot; : 8999.99,
    &quot;created_at&quot; : &quot;2021-09-15&quot;,
    &quot;description&quot; : &quot;iPhone 13屏幕采用6.1英寸OLED屏幕&quot;
  }
}
</code></pre>
<h4 id="_24">删除文档</h4>
<pre><code class="language-json">DELETE /products/_doc/1
</code></pre>
<pre><code class="language-json">{
  &quot;_index&quot; : &quot;products&quot;,
  &quot;_type&quot; : &quot;_doc&quot;,
  &quot;_id&quot; : &quot;1&quot;,
  &quot;_version&quot; : 2,
  &quot;result&quot; : &quot;deleted&quot;,
  &quot;_shards&quot; : {
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;failed&quot; : 0
  },
  &quot;_seq_no&quot; : 2,
  &quot;_primary_term&quot; : 1
}
</code></pre>
<h4 id="_25">更新文档</h4>
<pre><code class="language-http">PUT /products/_doc/sjfYnXwBVVbJgt24PlVU
{
  &quot;title&quot;:&quot;iphon15&quot;
}
</code></pre>
<blockquote>
<p>说明: 这种更新方式是先删除原始文档,在将更新文档以新的内容插入。</p>
</blockquote>
<pre><code class="language-http">POST /products/_doc/sjfYnXwBVVbJgt24PlVU/_update
{
    &quot;doc&quot; : {
        &quot;title&quot; : &quot;iphon15&quot;
    }
}
</code></pre>
<blockquote>
<p>说明: 这种方式可以将数据原始内容保存,并在此基础上更新。</p>
</blockquote>
<h4 id="_26">批量操作</h4>
<pre><code class="language-http">POST /products/_doc/_bulk #批量索引两条文档
    {&quot;index&quot;:{&quot;_id&quot;:&quot;1&quot;}}
        {&quot;title&quot;:&quot;iphone14&quot;,&quot;price&quot;:8999.99,&quot;created_at&quot;:&quot;2021-09-15&quot;,&quot;description&quot;:&quot;iPhone 13屏幕采用6.8英寸OLED屏幕&quot;}
    {&quot;index&quot;:{&quot;_id&quot;:&quot;2&quot;}}
        {&quot;title&quot;:&quot;iphone15&quot;,&quot;price&quot;:8999.99,&quot;created_at&quot;:&quot;2021-09-15&quot;,&quot;description&quot;:&quot;iPhone 15屏幕采用10.8英寸OLED屏幕&quot;}
</code></pre>
<pre><code class="language-http">POST /products/_doc/_bulk #更新文档同时删除文档
    {&quot;update&quot;:{&quot;_id&quot;:&quot;1&quot;}}
        {&quot;doc&quot;:{&quot;title&quot;:&quot;iphone17&quot;}}
    {&quot;delete&quot;:{&quot;_id&quot;:2}}
    {&quot;index&quot;:{}}
        {&quot;title&quot;:&quot;iphone19&quot;,&quot;price&quot;:8999.99,&quot;created_at&quot;:&quot;2021-09-15&quot;,&quot;description&quot;:&quot;iPhone 19屏幕采用61.8英寸OLED屏幕&quot;}
</code></pre>
<blockquote>
<p>说明:批量时不会因为一个失败而全部失败,而是继续执行后续操作,在返回时按照执行的状态返回!</p>
</blockquote>
<hr />
<h2 id="_27">高级查询</h2>
<h3 id="_28">说明</h3>
<p>​   ES中提供了一种强大的检索数据方式,这种检索方式称之为<code>Query DSL</code><Domain Specified Language> ,<code>Query DSL</code>是利用<code>Rest API传递JSON格式的请求体(Request Body)数据</code>与ES进行交互，这种方式的<code>丰富查询语法</code>让ES检索变得<code>更强大，更简洁</code>。</p>
<h3 id="_29">语法</h3>
<pre><code class="language-markdown"># GET /索引名/_doc/_search {json格式请求体数据}
# GET /索引名/_search {json格式请求体数据}
</code></pre>
<ul>
<li>测试数据</li>
</ul>
<pre><code class="language-markdown"># 1.创建索引 映射
PUT /products/
{
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;title&quot;:{
        &quot;type&quot;: &quot;keyword&quot;
      },
      &quot;price&quot;:{
        &quot;type&quot;: &quot;double&quot;
      },
      &quot;created_at&quot;:{
        &quot;type&quot;:&quot;date&quot;
      },
      &quot;description&quot;:{
        &quot;type&quot;:&quot;text&quot;
      }
    }
  }
}
# 2.测试数据
PUT /products/_doc/_bulk
{&quot;index&quot;:{}}
  {&quot;title&quot;:&quot;iphone12 pro&quot;,&quot;price&quot;:8999,&quot;created_at&quot;:&quot;2020-10-23&quot;,&quot;description&quot;:&quot;iPhone 12 Pro采用超瓷晶面板和亚光质感玻璃背板，搭配不锈钢边框，有银色、石墨色、金色、海蓝色四种颜色。宽度:71.5毫米，高度:146.7毫米，厚度:7.4毫米，重量：187克&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot;:&quot;iphone12&quot;,&quot;price&quot;:4999,&quot;created_at&quot;:&quot;2020-10-23&quot;,&quot;description&quot;:&quot;iPhone 12 高度：146.7毫米；宽度：71.5毫米；厚度：7.4毫米；重量：162克（5.73盎司） [5]  。iPhone 12设计采用了离子玻璃，以及7000系列铝金属外壳。&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot;:&quot;iphone13&quot;,&quot;price&quot;:6000,&quot;created_at&quot;:&quot;2021-09-15&quot;,&quot;description&quot;:&quot;iPhone 13屏幕采用6.1英寸OLED屏幕；高度约146.7毫米，宽度约71.5毫米，厚度约7.65毫米，重量约173克。&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot;:&quot;iphone13 pro&quot;,&quot;price&quot;:8999,&quot;created_at&quot;:&quot;2021-09-15&quot;,&quot;description&quot;:&quot;iPhone 13Pro搭载A15 Bionic芯片，拥有四种配色，支持5G。有128G、256G、512G、1T可选，售价为999美元起。&quot;}
</code></pre>
<h3 id="_30">常见检索</h3>
<h4 id="match_all">查询所有[match_all]</h4>
<blockquote>
<p><strong>match_all关键字:</strong>  返回索引中的全部文档</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  }
}
</code></pre>
<h4 id="term">关键词查询(term)</h4>
<blockquote>
<p><strong>term 关键字</strong>: 用来使用关键词查询</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
 &quot;query&quot;: {
   &quot;term&quot;: {
     &quot;price&quot;: {
       &quot;value&quot;: 4999
     }
   }
 }
}
</code></pre>
<blockquote>
<p>NOTE1:  通过使用term查询得知ES中默认使用分词器为<code>标准分词器(StandardAnalyzer),标准分词器对于英文单词分词,对于中文单字分词</code>。</p>
<p>NOTE2:  通过使用term查询得知,<code>在ES的Mapping Type 中 keyword , date ,integer, long , double , boolean or ip 这些类型不分词，只有text类型分词</code>。</p>
</blockquote>
<h4 id="range">范围查询[range]</h4>
<blockquote>
<p><strong>range 关键字</strong>: 用来指定查询指定范围内的文档</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;range&quot;: {
      &quot;price&quot;: {
        &quot;gte&quot;: 1400,
        &quot;lte&quot;: 9999
      }
    }
  }
}
</code></pre>
<h4 id="prefix">前缀查询[prefix]</h4>
<blockquote>
<p><strong>prefix 关键字</strong>: 用来检索含有指定前缀的关键词的相关文档</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;prefix&quot;: {
      &quot;title&quot;: {
        &quot;value&quot;: &quot;ipho&quot;
      }
    }
  }
}
</code></pre>
<h4 id="wildcard">通配符查询[wildcard]</h4>
<blockquote>
<p><strong>wildcard 关键字</strong>: 通配符查询     <strong>? 用来匹配一个任意字符  * 用来匹配多个任意字符</strong></p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;wildcard&quot;: {
      &quot;description&quot;: {
        &quot;value&quot;: &quot;iphon*&quot;
      }
    }
  }
}
</code></pre>
<h4 id="idids">多id查询[ids]</h4>
<blockquote>
<p><strong>ids 关键字</strong> : 值为数组类型,用来根据一组id获取多个对应的文档</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;ids&quot;: {
      &quot;values&quot;: [&quot;verUq3wBOTjuBizqAegi&quot;,&quot;vurUq3wBOTjuBizqAegk&quot;]
    }
  }
}
</code></pre>
<h4 id="fuzzy">模糊查询[fuzzy]</h4>
<blockquote>
<p><strong>fuzzy 关键字</strong>: 用来模糊查询含有指定关键字的文档</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;fuzzy&quot;: {
      &quot;description&quot;: &quot;iphooone&quot;
    }
  }
}
</code></pre>
<blockquote>
<p>注意: <code>fuzzy 模糊查询  最大模糊错误 必须在0-2之间</code></p>
<ul>
<li>
<p>搜索关键词长度为 2 不允许存在模糊</p>
</li>
<li>
<p>搜索关键词长度为3-5 允许一次模糊</p>
</li>
<li>
<p>搜索关键词长度大于5 允许最大2模糊</p>
</li>
</ul>
</blockquote>
<h4 id="bool">布尔查询[bool]</h4>
<blockquote>
<p><strong>bool 关键字</strong>: 用来组合多个条件实现复杂查询</p>
<p>​ <strong>must: 相当于&amp;&amp; 同时成立</strong></p>
<p>​ <strong>should: 相当于|| 成立一个就行</strong></p>
<p>​ <strong>must_not: 相当于!  不能满足任何一个</strong></p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {&quot;term&quot;: {
          &quot;price&quot;: {
            &quot;value&quot;: 4999
          }
        }}
      ]
    }
  }
}
</code></pre>
<h4 id="multi_match">多字段查询[multi_match]</h4>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;multi_match&quot;: {
      &quot;query&quot;: &quot;iphone13 毫&quot;,
      &quot;fields&quot;: [&quot;title&quot;,&quot;description&quot;]
    }
  }
}
注意: 字段类型分词,将查询条件分词之后进行查询改字段  如果该字段不分词就会将查询条件作为整体进行查询
</code></pre>
<h4 id="query_string">默认字段分词查询[query_string]</h4>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;query_string&quot;: {
      &quot;default_field&quot;: &quot;description&quot;,
      &quot;query&quot;: &quot;屏幕真的非常不错&quot;
    }
  }
}
注意: 查询字段分词就将查询条件分词查询  查询字段不分词将查询条件不分词查询
</code></pre>
<h4 id="highlight">高亮查询[highlight]</h4>
<blockquote>
<p><strong>highlight 关键字</strong>: 可以让符合条件的文档中的关键词高亮</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;description&quot;: {
        &quot;value&quot;: &quot;iphone&quot;
      }
    }
  },
  &quot;highlight&quot;: {
    &quot;fields&quot;: {
      &quot;*&quot;:{}
    }
  }
}
</code></pre>
<blockquote>
<p><strong>自定义高亮html标签</strong>: 可以在highlight中使用<code>pre_tags</code>和<code>post_tags</code></p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;description&quot;: {
        &quot;value&quot;: &quot;iphone&quot;
      }
    }
  },
  &quot;highlight&quot;: {
    &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;], 
    &quot;pre_tags&quot;: [&quot;&lt;span style='color:red'&gt;&quot;],
    &quot;fields&quot;: {
      &quot;*&quot;:{}
    }
  }
}
</code></pre>
<blockquote>
<p>多字段高亮 使用<code>require_field_match</code>开启多个字段高亮</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;description&quot;: {
        &quot;value&quot;: &quot;iphone&quot;
      }
    }
  },
  &quot;highlight&quot;: {
    &quot;require_field_match&quot;: &quot;false&quot;,
    &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;], 
    &quot;pre_tags&quot;: [&quot;&lt;span style='color:red'&gt;&quot;],
    &quot;fields&quot;: {
      &quot;*&quot;:{}
    }
  }
}
</code></pre>
<h4 id="size">返回指定条数[size]</h4>
<blockquote>
<p><strong>size 关键字</strong>: 指定查询结果中返回指定条数。  <strong>默认返回值10条</strong></p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;size&quot;: 5
}
</code></pre>
<h4 id="form">分页查询[form]</h4>
<blockquote>
<p><strong>from 关键字</strong>: 用来指定起始返回位置，和<strong>size关键字连用可实现分页效果</strong></p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;size&quot;: 5,
  &quot;from&quot;: 0
}
</code></pre>
<h4 id="sort">指定字段排序[sort]</h4>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;sort&quot;: [
    {
      &quot;price&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    }
  ]
}
</code></pre>
<h4 id="_source">返回指定字段[_source]</h4>
<blockquote>
<p><strong>_source 关键字</strong>: 是一个数组,在数组中用来指定展示那些字段</p>
</blockquote>
<pre><code class="language-http">GET /products/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  },
  &quot;_source&quot;: [&quot;title&quot;,&quot;description&quot;]
}
</code></pre>
<h2 id="_31">索引原理</h2>
<h3 id="_32">倒排索引</h3>
<p><code>倒排索引（Inverted Index）</code>也叫反向索引，有反向索引必有正向索引。通俗地来讲，<code>正向索引是通过key找value，反向索引则是通过value找key。ES底层在检索时底层使用的就是倒排索引。</code></p>
<h3 id="_33">索引模型</h3>
<p>现有索引和映射如下:</p>
<pre><code class="language-json">{
  &quot;products&quot; : {
    &quot;mappings&quot; : {
      &quot;properties&quot; : {
        &quot;description&quot; : {
          &quot;type&quot; : &quot;text&quot;
        },
        &quot;price&quot; : {
          &quot;type&quot; : &quot;float&quot;
        },
        &quot;title&quot; : {
          &quot;type&quot; : &quot;keyword&quot;
        }
      }
    }
  }
}
</code></pre>
<p>先录入如下数据，有三个字段title、price、description等</p>
<table>
<thead>
<tr>
<th>_id</th>
<th>title</th>
<th>price</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>蓝月亮洗衣液</td>
<td><code>19.9</code></td>
<td>蓝月亮洗衣液<code>很</code>高效</td>
</tr>
<tr>
<td>2</td>
<td>iphone13</td>
<td><code>19.9</code></td>
<td><code>很</code>不错的手机</td>
</tr>
<tr>
<td>3</td>
<td>小浣熊干脆面</td>
<td>1.5</td>
<td>小浣熊<code>很</code>好吃</td>
</tr>
</tbody>
</table>
<p>在ES中除了text类型分词，其他类型不分词，因此根据不同字段创建索引如下：</p>
<ul>
<li><strong>title字段:</strong></li>
</ul>
<table>
<thead>
<tr>
<th>term</th>
<th>_id(文档id)</th>
</tr>
</thead>
<tbody>
<tr>
<td>蓝月亮洗衣液</td>
<td>1</td>
</tr>
<tr>
<td>iphone13</td>
<td>2</td>
</tr>
<tr>
<td>小浣熊干脆面</td>
<td>3</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>price字段</strong></li>
</ul>
<table>
<thead>
<tr>
<th>term</th>
<th>_id(文档id)</th>
</tr>
</thead>
<tbody>
<tr>
<td>19.9</td>
<td>[1,2]</td>
</tr>
<tr>
<td>1.5</td>
<td>3</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>description字段</strong></li>
</ul>
<table>
<thead>
<tr>
<th>term</th>
<th>_id</th>
<th>term</th>
<th>_id</th>
<th>term</th>
<th>_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>蓝</td>
<td>1</td>
<td>不</td>
<td>2</td>
<td>小</td>
<td>3</td>
</tr>
<tr>
<td>月</td>
<td>1</td>
<td>错</td>
<td>2</td>
<td>浣</td>
<td>3</td>
</tr>
<tr>
<td>亮</td>
<td>1</td>
<td>的</td>
<td>2</td>
<td>熊</td>
<td>3</td>
</tr>
<tr>
<td>洗</td>
<td>1</td>
<td>手</td>
<td>2</td>
<td>好</td>
<td>3</td>
</tr>
<tr>
<td>衣</td>
<td>1</td>
<td>机</td>
<td>2</td>
<td>吃</td>
<td>3</td>
</tr>
<tr>
<td>液</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>很</td>
<td>[1:1:9,2:1:6,3:1:6]</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>高</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>效</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong><code>注意: Elasticsearch分别为每个字段都建立了一个倒排索引。因此查询时查询字段的term,就能知道文档ID，就能快速找到文档。</code></strong></p>
<h2 id="_34">分词器</h2>
<h3 id="analysis-analyzer">Analysis 和 Analyzer</h3>
<p><code>Analysis</code>： 文本分析是把全文本转换一系列单词(term/token)的过程，也叫分词(Analyzer)。<strong>Analysis是通过Analyzer来实现的</strong>。<code>分词就是将文档通过Analyzer分成一个一个的Term(关键词查询),每一个Term都指向包含这个Term的文档</code>。</p>
<h3 id="analyzer">Analyzer 组成</h3>
<ul>
<li>​ 注意: 在ES中默认使用标准分词器: StandardAnalyzer 特点: 中文单字分词  单词分词</li>
</ul>
<p>我是中国人 this is good man----&gt;  analyzer----&gt; 我  是  中  国  人   this  is  good man</p>
<blockquote>
<p>分析器（analyzer）都由三种构件组成的：<code>character filters</code> ， <code>tokenizers</code> ， <code>token filters</code>。</p>
</blockquote>
<ul>
<li><code>character filter</code> 字符过滤器</li>
<li>在一段文本进行分词之前，先进行预处理，比如说最常见的就是，过滤html标签（<span>hello<span> --&gt; hello），&amp; --&gt; and（I&amp;you --&gt; I and you）</li>
<li><code>tokenizers</code> 分词器</li>
<li>
<p>英文分词可以根据空格将单词分开,中文分词比较复杂,可以采用机器学习算法来分词。</p>
</li>
<li>
<p><code>Token filters</code> Token过滤器</p>
</li>
<li><strong>将切分的单词进行加工</strong>。大小写转换（例将“Quick”转为小写），去掉停用词（例如停用词像“a”、“and”、“the”等等），加入同义词（例如同义词像“jump”和“leap”）。</li>
</ul>
<p><code>注意:</code></p>
<ul>
<li>三者顺序: Character Filters---&gt;Tokenizer---&gt;Token Filter</li>
<li>三者个数：Character Filters（0个或多个） + Tokenizer + Token Filters(0个或多个)</li>
</ul>
<h3 id="_35">内置分词器</h3>
<ul>
<li>Standard Analyzer - 默认分词器，英文按单词词切分，并小写处理</li>
<li>Simple Analyzer - 按照单词切分(符号被过滤), 小写处理</li>
<li>Stop Analyzer - 小写处理，停用词过滤(the,a,is)</li>
<li>Whitespace Analyzer - 按照空格切分，不转小写</li>
<li>Keyword Analyzer - 不分词，直接将输入当作输出</li>
</ul>
<h3 id="_36">内置分词器测试</h3>
<ul>
<li>标准分词器</li>
<li>特点: 按照单词分词 英文统一转为小写 过滤标点符号  中文单字分词</li>
</ul>
<pre><code class="language-http">POST /_analyze
{
  &quot;analyzer&quot;: &quot;standard&quot;,
  &quot;text&quot;: &quot;this is a , good Man 中华人民共和国&quot;
}
</code></pre>
<ul>
<li>Simple 分词器</li>
<li>特点: 英文按照单词分词 英文统一转为小写 去掉符号 中文按照空格进行分词</li>
</ul>
<pre><code class="language-http">POST /_analyze
{
  &quot;analyzer&quot;: &quot;simple&quot;,
  &quot;text&quot;: &quot;this is a , good Man 中华人民共和国&quot;
}
</code></pre>
<ul>
<li>Whitespace 分词器</li>
<li>特点:  中文 英文 按照空格分词 英文不会转为小写  不去掉标点符号</li>
</ul>
<pre><code class="language-http">POST /_analyze
{
  &quot;analyzer&quot;: &quot;whitespace&quot;,
  &quot;text&quot;: &quot;this is a , good Man&quot;
}
</code></pre>
<h3 id="_37">创建索引设置分词</h3>
<pre><code class="language-json">PUT /索引名
{
  &quot;settings&quot;: {},
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;title&quot;:{
        &quot;type&quot;: &quot;text&quot;,
        &quot;analyzer&quot;: &quot;standard&quot; //显示指定分词器
      }
    }
  }
}
</code></pre>
<h3 id="_38">中文分词器</h3>
<p>在ES中支持中文分词器非常多 如 <strong>smartCN</strong>、<strong>IK</strong> 等，推荐的就是 <code>IK分词器</code>。</p>
<h4 id="ik">安装IK</h4>
<p>开源分词器 Ik 的github:https://github.com/medcl/elasticsearch-analysis-ik</p>
<ul>
<li><code>注意</code> IK分词器的版本要你安装ES的版本一致</li>
<li><code>注意</code> Docker 容器运行 ES 安装插件目录为 <strong>/usr/share/elasticsearch/plugins</strong></li>
</ul>
<pre><code class="language-markdown"># 1. 下载对应版本
- [es@linux ~]$ wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.14.0/elasticsearch-analysis-ik-7.14.0.zip

# 2. 解压
- [es@linux ~]$ unzip elasticsearch-analysis-ik-6.2.4.zip #先使用yum install -y unzip

# 3. 移动到es安装目录的plugins目录中
- [es@linux ~]$ ls elasticsearch-6.2.4/plugins/
    [es@linux ~]$ mv elasticsearch elasticsearch-6.2.4/plugins/
    [es@linux ~]$ ls elasticsearch-6.2.4/plugins/
        elasticsearch
    [es@linux ~]$ ls elasticsearch-6.2.4/plugins/elasticsearch/
        commons-codec-1.9.jar    config                               httpclient-4.5.2.jar          plugin-descriptor.properties
        commons-logging-1.2.jar  elasticsearch-analysis-ik-6.2.4.jar  httpcore-4.4.4.jar

# 4. 重启es生效

# 5. 本地安装ik配置目录为  
- es安装目录中/plugins/analysis-ik/config/IKAnalyzer.cfg.xml
</code></pre>
<h4 id="ik_1">IK使用</h4>
<p>IK有两种颗粒度的拆分：</p>
<ul>
<li>
<p><code>ik_smart</code>: 会做最粗粒度的拆分</p>
</li>
<li>
<p><code>ik_max_word</code>: 会将文本做最细粒度的拆分</p>
</li>
</ul>
<pre><code class="language-http">POST /_analyze
{
  &quot;analyzer&quot;: &quot;ik_smart&quot;,
  &quot;text&quot;: &quot;中华人民共和国国歌&quot;
}
</code></pre>
<p><img alt="image-20211024212944413" src="../ElasticSearch%207.14.assets/image-20211024212944413.png" /></p>
<pre><code class="language-http">POST /_analyze
{
  &quot;analyzer&quot;: &quot;ik_max_word&quot;,
  &quot;text&quot;: &quot;中华人民&quot;
}
</code></pre>
<p><img alt="image-20211024213133835" src="../ElasticSearch%207.14.assets/image-20211024213133835.png" /></p>
<h4 id="_39">扩展词、停用词配置</h4>
<p>IK支持自定义<code>扩展词典</code>和<code>停用词典</code></p>
<ul>
<li><strong><code>扩展词典</code></strong>就是有些词并不是关键词,但是也希望被ES用来作为检索的关键词,可以将这些词加入扩展词典。</li>
<li><strong><code>停用词典</code></strong>就是有些词是关键词,但是出于业务场景不想使用这些关键词被检索到，可以将这些词放入停用词典。</li>
</ul>
<p>定义扩展词典和停用词典可以修改IK分词器中<code>config</code>目录中<code>IKAnalyzer.cfg.xml</code>这个文件。</p>
<pre><code class="language-markdown">1. 修改vim IKAnalyzer.cfg.xml

    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;
    &lt;properties&gt;
        &lt;comment&gt;IK Analyzer 扩展配置&lt;/comment&gt;
        &lt;!--用户可以在这里配置自己的扩展字典 --&gt;
        &lt;entry key=&quot;ext_dict&quot;&gt;ext_dict.dic&lt;/entry&gt;
         &lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;
        &lt;entry key=&quot;ext_stopwords&quot;&gt;ext_stopword.dic&lt;/entry&gt;
    &lt;/properties&gt;

2. 在ik分词器目录下config目录中创建ext_dict.dic文件   编码一定要为UTF-8才能生效
    vim ext_dict.dic 加入扩展词即可

3. 在ik分词器目录下config目录中创建ext_stopword.dic文件 
    vim ext_stopword.dic 加入停用词即可

4.重启es生效
</code></pre>
<blockquote>
<p><code>注意:</code> <strong>词典的编码必须为UTF-8，否则无法生效!</strong></p>
</blockquote>
<hr />
<h2 id="_40">过滤查询<Filter Query></h2>
<h3 id="_41">过滤查询</h3>
<p>过滤查询<filter query>，其实准确来说，ES中的查询操作分为2种: <code>查询(query)</code>和<code>过滤(filter)</code>。查询即是之前提到的<code>query查询</code>，它 (查询)默认会计算每个返回文档的得分，然后根据得分排序。而<code>过滤(filter)</code>只会筛选出符合的文档，并不计算 得分，而且它可以缓存文档 。所以，单从性能考虑，过滤比查询更快。 换句话说<strong><code>过滤适合在大范围筛选数据，而查询则适合精确匹配数据。一般应用时， 应先使用过滤操作过滤数据， 然后使用查询匹配数据。</code></strong> </p>
<p><img alt="image-20211101113527794" src="../ElasticSearch%207.14.assets/image-20211101113527794.png" /></p>
<h3 id="_42">使用</h3>
<pre><code class="language-http">GET /ems/emp/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {&quot;match_all&quot;: {}} //查询条件
      ],
      &quot;filter&quot;: {....} //过滤条件
  }
}
</code></pre>
<ul>
<li><code>注意:</code></li>
<li>在执行 filter  和  query  时,先执行  filter  在执行 query</li>
<li>Elasticsearch会自动缓存经常使用的过滤器，以加快性能。</li>
</ul>
<h3 id="_43">类型</h3>
<blockquote>
<p>常见过滤类型有: term 、 terms 、ranage、exists、ids等filter。</p>
</blockquote>
<h4 id="term-terms-filter">term 、 terms Filter</h4>
<pre><code class="language-http">GET /ems/emp/_search   # 使用term过滤
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {&quot;term&quot;: {
          &quot;name&quot;: {
            &quot;value&quot;: &quot;小黑&quot;
          }
        }}
      ],
      &quot;filter&quot;: {
        &quot;term&quot;: {
          &quot;content&quot;:&quot;框架&quot;
        }
      }
    }
  }
}
GET /dangdang/book/_search  #使用terms过滤
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {&quot;term&quot;: {
          &quot;name&quot;: {
            &quot;value&quot;: &quot;中国&quot;
          }
        }}
      ],
      &quot;filter&quot;: {
        &quot;terms&quot;: {
          &quot;content&quot;:[
              &quot;科技&quot;,
              &quot;声音&quot;
            ]
        }
      }
    }
  }
}
</code></pre>
<h4 id="ranage-filter">ranage filter</h4>
<pre><code class="language-http">GET /ems/emp/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {&quot;term&quot;: {
          &quot;name&quot;: {
            &quot;value&quot;: &quot;中国&quot;
          }
        }}
      ],
      &quot;filter&quot;: {
        &quot;range&quot;: {
          &quot;age&quot;: {
            &quot;gte&quot;: 7,
            &quot;lte&quot;: 20
          }
        }
      }
    }
  }
}
</code></pre>
<h4 id="exists-filter">exists filter</h4>
<blockquote>
<p><strong>过滤存在指定字段,获取字段不为空的索引记录使用</strong></p>
</blockquote>
<pre><code class="language-http">GET /ems/emp/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {&quot;term&quot;: {
          &quot;name&quot;: {
            &quot;value&quot;: &quot;中国&quot;
          }
        }}
      ],
      &quot;filter&quot;: {
        &quot;exists&quot;: {
          &quot;field&quot;:&quot;aaa&quot;
        }
      }
    }
  }
}
</code></pre>
<h4 id="ids-filter">ids filter</h4>
<blockquote>
<p><strong>过滤含有指定字段的索引记录</strong></p>
</blockquote>
<pre><code class="language-http">GET /ems/emp/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {&quot;term&quot;: {
          &quot;name&quot;: {
            &quot;value&quot;: &quot;中国&quot;
          }
        }}
      ],
      &quot;filter&quot;: {
        &quot;ids&quot;: {
          &quot;values&quot;: [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]
        }
      }
    }
  }
}
</code></pre>
<hr />
<h2 id="_44">整合应用</h2>
<h3 id="_45">引入依赖</h3>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="_46">配置客户端</h3>
<pre><code class="language-java">@Configuration
public class RestClientConfig extends AbstractElasticsearchConfiguration {
    @Override
    @Bean
    public RestHighLevelClient elasticsearchClient() {
        final ClientConfiguration clientConfiguration = ClientConfiguration.builder()
                .connectedTo(&quot;172.16.91.10:9200&quot;)
                .build();
        return RestClients.create(clientConfiguration).rest();
    }
}
</code></pre>
<h3 id="_47">客户端对象</h3>
<ul>
<li>ElasticsearchOperations </li>
<li>RestHighLevelClient <strong>推荐</strong></li>
</ul>
<h4 id="elasticsearchoperations">ElasticsearchOperations</h4>
<ul>
<li>特点: 始终使用面向对象方式操作 ES</li>
<li>索引: 用来存放相似文档集合</li>
<li>映射: 用来决定放入文档的每个字段以什么样方式录入到 ES 中 字段类型 分词器..</li>
<li>文档: 可以被索引最小单元  json 数据格式</li>
</ul>
<h5 id="_48">相关注解</h5>
<pre><code class="language-java">@Document(indexName = &quot;products&quot;, createIndex = true)
public class Product {
        @Id
    private Integer id;
    @Field(type = FieldType.Keyword)
    private String title;
    @Field(type = FieldType.Float)
    private Double price;
    @Field(type = FieldType.Text)
    private String description;
    //get set ...
}
//1. @Document(indexName = &quot;products&quot;, createIndex = true) 用在类上 作用:代表一个对象为一个文档
        -- indexName属性: 创建索引的名称
    -- createIndex属性: 是否创建索引
//2. @Id 用在属性上  作用:将对象id字段与ES中文档的_id对应
//3. @Field(type = FieldType.Keyword) 用在属性上 作用:用来描述属性在ES中存储类型以及分词情况
    -- type: 用来指定字段类型
</code></pre>
<h5 id="_49">索引文档</h5>
<pre><code class="language-java"> @Test
public void testCreate() throws IOException {
  Product product = new Product();
  product.setId(1); //存在id指定id  不存在id自动生成id
  product.setTitle(&quot;怡宝矿泉水&quot;);
  product.setPrice(129.11);
  product.setDescription(&quot;我们喜欢喝矿泉水....&quot;);
  elasticsearchOperations.save(product);
}
</code></pre>
<h5 id="_50">删除文档</h5>
<pre><code class="language-java">@Test
public void testDelete() {
  Product product = new Product();
  product.setId(1);
  String delete = elasticsearchOperations.delete(product);
  System.out.println(delete);
}
</code></pre>
<h5 id="_51">查询文档</h5>
<pre><code class="language-java">@Test
public void testGet() {
  Product product = elasticsearchOperations.get(&quot;1&quot;, Product.class);
  System.out.println(product);
}
</code></pre>
<h5 id="_52">更新文档</h5>
<pre><code class="language-java"> @Test
public void testUpdate() {
  Product product = new Product();
  product.setId(1);
  product.setTitle(&quot;怡宝矿泉水&quot;);
  product.setPrice(129.11);
  product.setDescription(&quot;我们喜欢喝矿泉水,你们喜欢吗....&quot;);
  elasticsearchOperations.save(product);//不存在添加,存在更新
}
</code></pre>
<h5 id="_53">删除所有</h5>
<pre><code class="language-java">@Test
public void testDeleteAll() {
  elasticsearchOperations.delete(Query.findAll(), Product.class);
}
</code></pre>
<h5 id="_54">查询所有</h5>
<pre><code class="language-java">@Test
public void testFindAll() {
  SearchHits&lt;Product&gt; productSearchHits = elasticsearchOperations.search(Query.findAll(), Product.class);
  productSearchHits.forEach(productSearchHit -&gt; {
    System.out.println(&quot;id: &quot; + productSearchHit.getId());
    System.out.println(&quot;score: &quot; + productSearchHit.getScore());
    Product product = productSearchHit.getContent();
    System.out.println(&quot;product: &quot; + product);
  });
}
</code></pre>
<h3 id="resthighlevelclient">RestHighLevelClient</h3>
<h5 id="_55">创建索引映射</h5>
<pre><code class="language-java"> @Test
    public void testCreateIndex() throws IOException {
        CreateIndexRequest createIndexRequest = new CreateIndexRequest(&quot;fruit&quot;);
        createIndexRequest.mapping(&quot;{\n&quot; +
                &quot;    \&quot;properties\&quot;: {\n&quot; +
                &quot;      \&quot;title\&quot;:{\n&quot; +
                &quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot; +
                &quot;      },\n&quot; +
                &quot;      \&quot;price\&quot;:{\n&quot; +
                &quot;        \&quot;type\&quot;: \&quot;double\&quot;\n&quot; +
                &quot;      },\n&quot; +
                &quot;      \&quot;created_at\&quot;:{\n&quot; +
                &quot;        \&quot;type\&quot;: \&quot;date\&quot;\n&quot; +
                &quot;      },\n&quot; +
                &quot;      \&quot;description\&quot;:{\n&quot; +
                &quot;        \&quot;type\&quot;: \&quot;text\&quot;\n&quot; +
                &quot;      }\n&quot; +
                &quot;    }\n&quot; +
                &quot;  }\n&quot; , XContentType.JSON);
        CreateIndexResponse createIndexResponse = restHighLevelClient.indices().create(createIndexRequest, RequestOptions.DEFAULT);
        System.out.println(createIndexResponse.isAcknowledged());
        restHighLevelClient.close();
    }
</code></pre>
<h5 id="_56">索引文档</h5>
<pre><code class="language-java">@Test
public void testIndex() throws IOException {
  IndexRequest indexRequest = new IndexRequest(&quot;fruit&quot;);
  indexRequest.source(&quot;{\n&quot; +
                      &quot;          \&quot;id\&quot; : 1,\n&quot; +
                      &quot;          \&quot;title\&quot; : \&quot;蓝月亮\&quot;,\n&quot; +
                      &quot;          \&quot;price\&quot; : 123.23,\n&quot; +
                      &quot;          \&quot;description\&quot; : \&quot;这个洗衣液非常不错哦！\&quot;\n&quot; +
                      &quot;        }&quot;,XContentType.JSON);
  IndexResponse index = restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);
  System.out.println(index.status());
}
</code></pre>
<h5 id="_57">更新文档</h5>
<pre><code class="language-java">@Test
public void testUpdate() throws IOException {
  UpdateRequest updateRequest = new UpdateRequest(&quot;fruit&quot;,&quot;qJ0R9XwBD3J1IW494-Om&quot;);
  updateRequest.doc(&quot;{\&quot;title\&quot;:\&quot;好月亮\&quot;}&quot;,XContentType.JSON);
  UpdateResponse update = restHighLevelClient.update(updateRequest, RequestOptions.DEFAULT);
  System.out.println(update.status());
}
</code></pre>
<h5 id="_58">删除文档</h5>
<pre><code class="language-java">@Test
public void testDelete() throws IOException {
  DeleteRequest deleteRequest = new DeleteRequest(&quot;fruit&quot;,&quot;1&quot;);
  DeleteResponse delete = restHighLevelClient.delete(deleteRequest, RequestOptions.DEFAULT);
  System.out.println(delete.status());
}
</code></pre>
<h5 id="id">基于 id 查询文档</h5>
<pre><code class="language-java">@Test
public void testGet() throws IOException {
  GetRequest getRequest = new GetRequest(&quot;fruit&quot;,&quot;1&quot;);
  GetResponse getResponse = restHighLevelClient.get(getRequest, RequestOptions.DEFAULT);
  System.out.println(getResponse.getSourceAsString());
}
</code></pre>
<h5 id="_59">查询所有</h5>
<pre><code class="language-java"> @Test
public void testSearch() throws IOException {
  SearchRequest searchRequest = new SearchRequest(&quot;fruit&quot;);
  SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
  sourceBuilder.query(QueryBuilders.matchAllQuery());
  searchRequest.source(sourceBuilder);
  SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);
  //System.out.println(searchResponse.getHits().getTotalHits().value);
  SearchHit[] hits = searchResponse.getHits().getHits();
  for (SearchHit hit : hits) {
    System.out.println(hit.getSourceAsString());
  }
}
</code></pre>
<h5 id="_60">综合查询</h5>
<pre><code class="language-java"> @Test
public void testSearch() throws IOException {
  SearchRequest searchRequest = new SearchRequest(&quot;fruit&quot;);
  SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
  sourceBuilder
    .from(0)
    .size(2)
    .sort(&quot;price&quot;, SortOrder.DESC)
    .fetchSource(new String[]{&quot;title&quot;},new String[]{})
    .highlighter(new HighlightBuilder().field(&quot;description&quot;).requireFieldMatch(false).preTags(&quot;&lt;span style='color:red;'&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;))
    .query(QueryBuilders.termQuery(&quot;description&quot;,&quot;错&quot;));
  searchRequest.source(sourceBuilder);
  SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);
  System.out.println(&quot;总条数: &quot;+searchResponse.getHits().getTotalHits().value);
  SearchHit[] hits = searchResponse.getHits().getHits();
  for (SearchHit hit : hits) {
    System.out.println(hit.getSourceAsString());
    Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();
    highlightFields.forEach((k,v)-&gt; System.out.println(&quot;key: &quot;+k + &quot; value: &quot;+v.fragments()[0]));
  }
}
</code></pre>
<hr />
<h2 id="_61">聚合查询</h2>
<h3 id="_62">简介</h3>
<p>聚合：<strong>英文为Aggregation，是es除搜索功能外提供的针对es数据做统计分析的功能</strong>。聚合有助于根据搜索查询提供聚合数据。聚合查询是数据库中重要的功能特性，ES作为搜索引擎兼数据库，同样提供了强大的聚合分析能力。它基于查询条件来对数据进行分桶、计算的方法。有点类似于 SQL 中的 group by 再加一些函数方法的操作。</p>
<blockquote>
<p><code>注意事项：text类型是不支持聚合的。</code></p>
</blockquote>
<h3 id="_63">测试数据</h3>
<pre><code class="language-json"># 创建索引 index 和映射 mapping
PUT /fruit
{
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;title&quot;:{
        &quot;type&quot;: &quot;keyword&quot;
      },
      &quot;price&quot;:{
        &quot;type&quot;:&quot;double&quot;
      },
      &quot;description&quot;:{
        &quot;type&quot;: &quot;text&quot;,
        &quot;analyzer&quot;: &quot;ik_max_word&quot;
      }
    }
  }
}
# 放入测试数据
PUT /fruit/_bulk
{&quot;index&quot;:{}}
  {&quot;title&quot; : &quot;面包&quot;,&quot;price&quot; : 19.9,&quot;description&quot; : &quot;小面包非常好吃&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot; : &quot;旺仔牛奶&quot;,&quot;price&quot; : 29.9,&quot;description&quot; : &quot;非常好喝&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot; : &quot;日本豆&quot;,&quot;price&quot; : 19.9,&quot;description&quot; : &quot;日本豆非常好吃&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot; : &quot;小馒头&quot;,&quot;price&quot; : 19.9,&quot;description&quot; : &quot;小馒头非常好吃&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot; : &quot;大辣片&quot;,&quot;price&quot; : 39.9,&quot;description&quot; : &quot;大辣片非常好吃&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot; : &quot;透心凉&quot;,&quot;price&quot; : 9.9,&quot;description&quot; : &quot;透心凉非常好喝&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot; : &quot;小浣熊&quot;,&quot;price&quot; : 19.9,&quot;description&quot; : &quot;童年的味道&quot;}
{&quot;index&quot;:{}}
  {&quot;title&quot; : &quot;海苔&quot;,&quot;price&quot; : 19.9,&quot;description&quot; : &quot;海的味道&quot;}
</code></pre>
<h3 id="_64">使用</h3>
<h4 id="_65">根据某个字段分组</h4>
<pre><code class="language-http"># 根据某个字段进行分组 统计数量
GET /fruit/_search
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;description&quot;: {
        &quot;value&quot;: &quot;好吃&quot;
      }
    }
  }, 
  &quot;aggs&quot;: {
    &quot;price_group&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;price&quot;
      }
    }
  }
}
</code></pre>
<h4 id="_66">求最大值</h4>
<pre><code class="language-http"># 求最大值 
GET /fruit/_search
{
  &quot;aggs&quot;: {
    &quot;price_max&quot;: {
      &quot;max&quot;: {
        &quot;field&quot;: &quot;price&quot;
      }
    }
  }
}
</code></pre>
<h4 id="_67">求最小值</h4>
<pre><code class="language-http"># 求最小值
GET /fruit/_search
{
  &quot;aggs&quot;: {
    &quot;price_min&quot;: {
      &quot;min&quot;: {
        &quot;field&quot;: &quot;price&quot;
      }
    }
  }
}
</code></pre>
<h4 id="_68">求平均值</h4>
<pre><code class="language-http"># 求平均值
GET /fruit/_search
{
  &quot;aggs&quot;: {
    &quot;price_agv&quot;: {
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;price&quot;
      }
    }
  }
}
</code></pre>
<h4 id="_69">求和</h4>
<pre><code class="language-http"># 求和
GET /fruit/_search
{
  &quot;aggs&quot;: {
    &quot;price_sum&quot;: {
      &quot;sum&quot;: {
        &quot;field&quot;: &quot;price&quot;
      }
    }
  }
}
</code></pre>
<h4 id="_70">整合应用</h4>
<pre><code class="language-java">// 求不同价格的数量
@Test
public void testAggsPrice() throws IOException {
  SearchRequest searchRequest = new SearchRequest(&quot;fruit&quot;);
  SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
  sourceBuilder.aggregation(AggregationBuilders.terms(&quot;group_price&quot;).field(&quot;price&quot;));
  searchRequest.source(sourceBuilder);
  SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);
  Aggregations aggregations = searchResponse.getAggregations();
  ParsedDoubleTerms terms = aggregations.get(&quot;group_price&quot;);
  List&lt;? extends Terms.Bucket&gt; buckets = terms.getBuckets();
  for (Terms.Bucket bucket : buckets) {
    System.out.println(bucket.getKey() + &quot;, &quot;+ bucket.getDocCount());
  }
}
</code></pre>
<pre><code class="language-java">// 求不同名称的数量
@Test
public void testAggsTitle() throws IOException {
  SearchRequest searchRequest = new SearchRequest(&quot;fruit&quot;);
  SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
  sourceBuilder.aggregation(AggregationBuilders.terms(&quot;group_title&quot;).field(&quot;title&quot;));
  searchRequest.source(sourceBuilder);
  SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);
  Aggregations aggregations = searchResponse.getAggregations();
  ParsedStringTerms terms = aggregations.get(&quot;group_title&quot;);
  List&lt;? extends Terms.Bucket&gt; buckets = terms.getBuckets();
  for (Terms.Bucket bucket : buckets) {
    System.out.println(bucket.getKey() + &quot;, &quot;+ bucket.getDocCount());
  }
}
</code></pre>
<pre><code class="language-java">// 求和
@Test
public void testAggsSum() throws IOException {
  SearchRequest searchRequest = new SearchRequest(&quot;fruit&quot;);
  SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();
  sourceBuilder.aggregation(AggregationBuilders.sum(&quot;sum_price&quot;).field(&quot;price&quot;));
  searchRequest.source(sourceBuilder);
  SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);
  ParsedSum parsedSum = searchResponse.getAggregations().get(&quot;sum_price&quot;);
  System.out.println(parsedSum.getValue());
}
</code></pre>
<hr />
<h2 id="cluster">集群 Cluster</h2>
<h3 id="_71">相关概念</h3>
<h4 id="_72">集群<cluster></h4>
<p>一个集群就是由一个或多个节点组织在一起，<code>它们共同持有你整个的数据，并一起提供索引和搜索功能</code>。一个集群由一个唯一的名字标识，这个名字默认就是<code>elasticsearch</code>。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群。</p>
<h4 id="_73">节点<node></h4>
<p>一个节点是你集群中的一个服务器，作为集群的一部分，它存储你的数据，参与集群的索引和搜索功能。和集群类似，一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色的名字，这个名字会在启动的时候赋予节点。</p>
<h4 id="_74">索引<Index></h4>
<p>一组相似文档的集合</p>
<h4 id="_75">映射<Mapping></h4>
<p>用来定义索引存储文档的结构如：字段、类型等。</p>
<h4 id="_76">文档<Document></h4>
<p>索引中一条记录,可以被索引的最小单元</p>
<h4 id="_77">分片<shards></h4>
<p>Elasticsearch提供了将索引划分成多份的能力，这些份就叫做分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置 到集群中的任何节点上。</p>
<h4 id="_78">复制<replicas></h4>
<p>Index的分片中一份或多份副本。</p>
<h3 id="_79">搭建集群</h3>
<h4 id="_80">集群规划</h4>
<pre><code class="language-markdown"># 1.准备3个ES节点和一个kibana 节点  ES 9200 9300 
- web: 9201 tcp:9301  node-1  elasticsearch.yml   
- web: 9202 tcp:9302  node-2  elasticsearch.yml
- web: 9203 tcp:9303  node-3  elasticsearch.yml
- kibana: 5602
</code></pre>
<ul>
<li>注意</li>
<li>所有节点集群名称必须一致     cluster.name</li>
<li>每个节点必须有一个唯一名字 node.name</li>
<li>开启每个节点远程连接  network.host: 0.0.0.0</li>
<li>指定使用 IP地址进行集群节点通信 network.publish_host:</li>
<li>修改 web 端口 tcp 端口 http.port:  transport.tcp.port</li>
<li>指定集群中所有节点通信列表 discovery.seed_hosts: node-1 node-2 node-3 相同</li>
<li>允许集群初始化 master 节点节点数: cluster.initial_master_nodes: ["node-1", "node-2","node-3"]</li>
<li>集群最少几个节点可用 gateway.recover_after_nodes: 2</li>
<li>开启每个节点跨域访问http.cors.enabled: true http.cors.allow-origin: "*"</li>
</ul>
<h4 id="_81">配置文件</h4>
<pre><code class="language-markdown"># node-1 配置文件
</code></pre>
<pre><code class="language-yml"># 指定集群名称 3个节点必须一致
cluster.name: es-cluster
# 指定节点名称 每个节点名字唯一
node.name: node-1
# 开放远程链接
network.host: 0.0.0.0
# 指定使用发布地址进行集群间通信
network.publish_host: 192.168.124.3
# 指定 web 端口
http.port: 9201
# 指定 tcp 端口
transport.tcp.port: 9301
# 指定所有节点的 tcp 通信
discovery.seed_hosts: [&quot;192.168.124.3:9301&quot;, &quot;192.168.124.3:9302&quot;,&quot;192.168.124.3:9303&quot;]
# 指定可以初始化集群的节点名称
cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;,&quot;node-3&quot;]
# 集群最少几个几点可用
gateway.recover_after_nodes: 2
# 解决跨域问题
http.cors.enabled: true
http.cors.allow-origin: &quot;*&quot;
</code></pre>
<pre><code class="language-markdown"># node-2 配置文件
</code></pre>
<pre><code class="language-yml"># 指定集群名称 3个节点必须一致
cluster.name: es-cluster
# 指定节点名称 每个节点名字唯一
node.name: node-2
# 开放远程链接
network.host: 0.0.0.0
# 指定使用发布地址进行集群间通信
network.publish_host: 192.168.124.3
# 指定 web 端口
http.port: 9202
# 指定 tcp 端口
transport.tcp.port: 9302
# 指定所有节点的 tcp 通信
discovery.seed_hosts: [&quot;192.168.124.3:9301&quot;, &quot;192.168.124.3:9302&quot;,&quot;192.168.124.3:9303&quot;]
# 指定可以初始化集群的节点名称
cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;,&quot;node-3&quot;]
# 集群最少几个几点可用
gateway.recover_after_nodes: 2
# 解决跨域问题
http.cors.enabled: true
http.cors.allow-origin: &quot;*&quot;
</code></pre>
<pre><code class="language-markdown"># node-3 配置文件
</code></pre>
<pre><code class="language-yml"># 指定集群名称 3个节点必须一致
cluster.name: es-cluster
# 指定节点名称 每个节点名字唯一
node.name: node-2
# 开放远程链接
network.host: 0.0.0.0
# 指定使用发布地址进行集群间通信
network.publish_host: 192.168.124.3
# 指定 web 端口
http.port: 9202
# 指定 tcp 端口
transport.tcp.port: 9302
# 指定所有节点的 tcp 通信
discovery.seed_hosts: [&quot;192.168.124.3:9301&quot;, &quot;192.168.124.3:9302&quot;,&quot;192.168.124.3:9303&quot;]
# 指定可以初始化集群的节点名称
cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;,&quot;node-3&quot;]
# 集群最少几个几点可用
gateway.recover_after_nodes: 2
# 解决跨域问题
http.cors.enabled: true
http.cors.allow-origin: &quot;*&quot;
</code></pre>
<h4 id="compose_1">编写 compose 文件</h4>
<pre><code class="language-yml">version: &quot;3.8&quot;
networks:
  escluster:
services:
  es01:
    image: elasticsearch:7.14.0
    ports:
      - &quot;9201:9201&quot;
      - &quot;9301:9301&quot;
    networks:
      - &quot;escluster&quot;
    volumes:
      - ./node-1/data:/usr/share/elasticsearch/data
      - ./node-1/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
      - ./node-1/plugins/ik:/usr/share/elasticsearch/plugins/ik
    environment:
      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;

  es02:
    image: elasticsearch:7.14.0
    ports:
      - &quot;9202:9202&quot;
      - &quot;9302:9302&quot;
    networks:
      - &quot;escluster&quot;
    volumes:
      - ./node-2/data:/usr/share/elasticsearch/data
      - ./node-2/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
      - ./node-2/plugins/ik:/usr/share/elasticsearch/plugins/ik
    environment:
      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;

  es03:
    image: elasticsearch:7.14.0
    ports:
      - &quot;9203:9203&quot;
      - &quot;9303:9303&quot;
    networks:
      - &quot;escluster&quot;
    volumes:
      - ./node-3/data:/usr/share/elasticsearch/data
      - ./node-3/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
      - ./node-3/plugins/ik:/usr/share/elasticsearch/plugins/ik
    environment:
      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;

  kibana:
    image: kibana:7.14.0
    ports:
      - &quot;5602:5601&quot;
    networks:
      - &quot;escluster&quot;
    volumes:
      - ./kibana.yml:/usr/share/kibana/config/kibana.yml
</code></pre>
<h4 id="kibana_1">kibana 配置文件</h4>
<pre><code class="language-yml"># kibana配置文件 连接到ES
server.host: &quot;0&quot;
server.shutdownTimeout: &quot;5s&quot;
elasticsearch.hosts: [ &quot;http://192.168.124.3:9201&quot; ] #链接任意节点即可
monitoring.ui.container.elasticsearch.enabled: true
</code></pre>
<h4 id="_82">查看集群状态</h4>
<pre><code class="language-http">http://10.102.115.3:9200/_cat/health?v
</code></pre>
<hr />
<h3 id="head">安装head插件</h3>
<pre><code class="language-markdown">1. 访问github网站
    搜索: elasticsearch-head 插件

2. 安装git
    yum install git

3. 将elasticsearch-head下载到本地
    git clone git://github.com/mobz/elasticsearch-head.git

4. 安装nodejs
    #注意: 没有wget的请先安装yum install -y wget
    wget http://cdn.npm.taobao.org/dist/node/latest-v8.x/node-v8.1.2-linux-x64.tar.xz

5. 解压缩nodejs
    xz -d node-v10.15.3-linux-arm64.tar.xz
    tar -xvf node-v10.15.3-linux-arm64.tar

6. 配置环境变量
    mv node-v10.15.3-linux-arm64 nodejs
    mv nodejs /usr/nodejs
    vim /etc/profile
        export NODE_HOME=/usr/nodejs
        export PATH=$PATH:$JAVA_HOME/bin:$NODE_HOME/bin

7.  进入elasticsearch-head的目录
    npm config set registry https://registry.npm.taobao.org
    npm install
    npm run start


8.  启动访问head插件 默认端口9100
    http://ip:9100  查看集群状态
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
